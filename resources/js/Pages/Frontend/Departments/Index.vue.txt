<script setup>
import GuestLayout from "@/Layouts/GuestLayout.vue";
import { Head, Link } from "@inertiajs/vue3";
import { ref, computed } from "vue";

defineProps({
    title: {
        type: String,
        default: "Our Departments",
    },
    logoUrl: {
        type: String,
        required: true,
    },
    departments: {
        type: Object,
        required: true,
    },
    featuredDepartments: {
        type: Array,
        default: () => [],
    },
    filters: {
        type: Object,
        default: () => ({
            search: "",
        }),
    },
});

const search = ref("");

const filteredDepartments = computed(() => {
    return departments.data.filter((dept) => {
        return (
            dept.name.toLowerCase().includes(search.value.toLowerCase()) ||
            dept.description.toLowerCase().includes(search.value.toLowerCase())
        );
    });
});
</script>

<template>
    <GuestLayout :title="title" :menuLogo="logoUrl" :footerLogo="logoUrl">
        <Head :title="title" />

        <!-- Hero Section -->
        <div
            class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-16"
        >
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">
                    Our Departments
                </h1>
                <p class="text-xl md:text-2xl max-w-3xl mx-auto">
                    Connect with various government departments and access their
                    services.
                </p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-12">
            <!-- Search -->
            <div class="mb-8 bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div class="max-w-2xl mx-auto">
                    <label for="search" class="sr-only"
                        >Search departments</label
                    >
                    <div class="relative">
                        <div
                            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                        >
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input
                            type="text"
                            id="search"
                            v-model="search"
                            class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                            placeholder="Search departments..."
                        />
                    </div>
                </div>
            </div>

            <!-- Featured Departments -->
            <div v-if="featuredDepartments.length > 0" class="mb-12">
                <h2
                    class="text-2xl font-bold text-gray-900 dark:text-white mb-6"
                >
                    Featured Departments
                </h2>
                <div
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                    <div
                        v-for="dept in featuredDepartments"
                        :key="'featured-' + dept.id"
                        class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 border-l-4 border-blue-500"
                    >
                        <div class="p-6">
                            <div class="flex items-center mb-4">
                                <div
                                    class="p-3 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300"
                                >
                                    <i
                                        :class="
                                            dept.icon_path ||
                                            'fas fa-building text-2xl'
                                        "
                                    ></i>
                                </div>
                                <h3
                                    class="ml-4 text-xl font-semibold text-gray-900 dark:text-white"
                                >
                                    <Link
                                        :href="
                                            route('frontend.show.department', {
                                                id: dept.id,
                                            })
                                        "
                                        class="hover:text-blue-600 dark:hover:text-blue-400"
                                    >
                                        {{ dept.name }}
                                    </Link>
                                </h3>
                            </div>
                            <p
                                class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-3"
                            >
                                {{ dept.short_description || dept.description }}
                            </p>
                            <div class="flex justify-between items-center">
                                <Link
                                    :href="
                                        route('frontend.show.department', {
                                            id: dept.id,
                                        })
                                    "
                                    class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium text-sm flex items-center"
                                >
                                    View Department
                                    <i
                                        class="fas fa-arrow-right ml-1 text-xs"
                                    ></i>
                                </Link>
                                <span
                                    v-if="dept.services_count"
                                    class="text-sm text-gray-500 dark:text-gray-400"
                                >
                                    {{ dept.services_count }} services
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Departments -->
            <div>
                <div class="flex justify-between items-center mb-6">
                    <h2
                        class="text-2xl font-bold text-gray-900 dark:text-white"
                    >
                        All Departments
                    </h2>
                    <span class="text-sm text-gray-500 dark:text-gray-400">
                        Showing {{ departments.from }}-{{ departments.to }} of
                        {{ departments.total }} departments
                    </span>
                </div>

                <div
                    v-if="departments.data.length > 0"
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"
                >
                    <div
                        v-for="dept in departments.data"
                        :key="dept.id"
                        class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300"
                    >
                        <div class="p-6">
                            <div class="flex items-center mb-4">
                                <div
                                    class="p-3 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300"
                                >
                                    <i
                                        :class="
                                            dept.icon_path ||
                                            'fas fa-building text-2xl'
                                        "
                                    ></i>
                                </div>
                                <h3
                                    class="ml-4 text-lg font-semibold text-gray-900 dark:text-white"
                                >
                                    <Link
                                        :href="
                                            route('frontend.show.department', {
                                                id: dept.id,
                                            })
                                        "
                                        class="hover:text-blue-600 dark:hover:text-blue-400"
                                    >
                                        {{ dept.name }}
                                    </Link>
                                </h3>
                            </div>
                            <p
                                class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-3"
                            >
                                {{ dept.short_description || dept.description }}
                            </p>
                            <div class="flex justify-between items-center">
                                <Link
                                    :href="
                                        route('frontend.show.department', {
                                            id: dept.id,
                                        })
                                    "
                                    class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium text-sm flex items-center"
                                >
                                    View Details
                                    <i
                                        class="fas fa-arrow-right ml-1 text-xs"
                                    ></i>
                                </Link>
                                <span
                                    v-if="dept.services_count"
                                    class="text-sm text-gray-500 dark:text-gray-400"
                                >
                                    {{ dept.services_count }} services
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Results -->
                <div v-else class="text-center py-12">
                    <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                    <h3
                        class="text-lg font-medium text-gray-900 dark:text-white"
                    >
                        No departments found
                    </h3>
                    <p class="mt-1 text-gray-500 dark:text-gray-400">
                        We couldn't find any departments matching your search
                        criteria.
                    </p>
                </div>

                <!-- Pagination -->
                <div
                    v-if="departments.last_page > 1"
                    class="mt-8 flex justify-center"
                >
                    <nav
                        class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"
                        aria-label="Pagination"
                    >
                        <Link
                            v-for="page in departments.last_page"
                            :key="page"
                            :href="route('frontend.departments', { page })"
                            :class="{
                                'z-10 bg-blue-50 border-blue-500 text-blue-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium':
                                    departments.current_page === page,
                                'bg-white dark:bg-gray-800 border-gray-300 text-gray-500 hover:bg-gray-50 dark:hover:bg-gray-700 relative inline-flex items-center px-4 py-2 border text-sm font-medium':
                                    departments.current_page !== page,
                            }"
                        >
                            {{ page }}
                        </Link>
                    </nav>
                </div>
            </div>
        </div>
    </GuestLayout>
</template>

import{f as h,T as I,i as c,o as m,e as s,u as a,Z as j,w as g,d as o,k as b,t as w,n as y,C as A,B,l as x,F as M,S as f}from"./vendor-Bxre9-EX.js";import{A as U}from"./AuthenticationCard-bbT-ft5b.js";import{_ as F}from"./AuthenticationCardLogo-CCECX_LH.js";import{_ as N}from"./Checkbox-eqsYePl1.js";import{_ as k}from"./InputError-B-044Lai.js";import{_ as C}from"./InputLabel-CwSxgxQN.js";import{_ as L}from"./PrimaryButton-Bn8ATV9O.js";import{_ as V}from"./TextInput-CQrGoHHq.js";import{_ as X}from"./ReCaptcha-CF-9UE0x.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"p-2 space-y-4 md:space-y-6 sm:p-8"},H={key:0,class:"mb-4 font-medium text-sm text-green-600"},W={class:"border-b border-gray-200 dark:border-gray-700"},z={class:"flex flex-wrap -mb-px text-sm font-medium text-center"},K={class:"me-2"},Z={class:"me-2"},G={key:0},J={class:"flex items-center justify-between"},Q={key:1},Y={class:"flex items-center justify-between"},ee=["disabled"],te={key:0,class:"mt-2 text-sm text-green-600"},re={class:"flex items-center justify-between"},oe={for:"remember",class:"flex items-center"},se={class:"ms-2 text-sm text-gray-600 dark:text-gray-400"},ae={class:"mt-4"},ne={class:"mt-4"},le={class:"text-sm font-light text-gray-500 dark:text-gray-400"},be={__name:"Login",props:{canResetPassword:Boolean,status:String},setup($){const n=h("password"),u=h(!1),d=h(0),v=h(null),e=I({login:"",password:"",otp:"",remember:!1,"g-recaptcha-response":""}),q=l=>{e["g-recaptcha-response"]=l},O=async()=>{var l,t;if(!e.login){e.errors.login="Telephone number is required";return}try{const r=await axios.post("/api/auth/request-otp",{telephone:e.login},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(r.data.status==="success")u.value=!0,R(),e.errors.login="",f.fire({toast:!0,position:"top-end",icon:"success",title:r.data.message||"OTP sent successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});else throw new Error(r.data.message||"Failed to send OTP")}catch(r){console.error("OTP Error:",r);const p=((t=(l=r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"Failed to send OTP. Please try again.";e.errors.login=p,f.fire({toast:!0,position:"top-end",icon:"error",title:p,showConfirmButton:!1,timer:5e3,timerProgressBar:!0})}},R=()=>{d.value=60,clearInterval(v.value),v.value=setInterval(()=>{d.value>0?d.value--:clearInterval(v.value)},1e3)},T=l=>{n.value=l,e.clearErrors(),u.value=!1,clearInterval(v.value),d.value=0},E=async()=>{var l,t,r,p,P,S;if(n.value==="password")try{const i=await axios.post(route("login"),{login:e.login,password:e.password,remember:e.remember?"on":""});f.fire({toast:!0,position:"top-end",icon:"success",title:"Login successful!",showConfirmButton:!1,timer:1500}).then(()=>{window.location.href=`${route("auto.login")}?telephone=${encodeURIComponent(e.login)}`})}catch(i){let _="An error occurred during login.";(t=(l=i.response)==null?void 0:l.data)!=null&&t.errors?(e.errors=i.response.data.errors,_=Object.values(i.response.data.errors).flat().join(" ")):(p=(r=i.response)==null?void 0:r.data)!=null&&p.message&&(_=i.response.data.message),f.fire({toast:!0,position:"top-end",icon:"error",title:_,showConfirmButton:!1,timer:3e3})}else try{const i=await axios.post("/api/auth/verify-otp",{telephone:e.login,otp:e.otp,remember:e.remember},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});f.fire({toast:!0,position:"top-end",icon:"success",title:"OTP verified successfully!",showConfirmButton:!1,timer:1500}).then(()=>{window.location.href=`${route("auto.login")}?telephone=${encodeURIComponent(e.login)}`})}catch(i){console.error("OTP Verification Error:",i),e.errors.otp=((S=(P=i.response)==null?void 0:P.data)==null?void 0:S.message)||i.message||"An error occurred. Please try again."}};return(l,t)=>(m(),c(M,null,[s(a(j),{title:"Sign in"}),s(U,null,{logo:g(()=>[s(F)]),default:g(()=>[o("div",D,[$.status?(m(),c("div",H,w($.status),1)):b("",!0),t[9]||(t[9]=o("h1",{class:"text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white"}," Sign in to your account ",-1)),o("div",W,[o("ul",z,[o("li",K,[o("button",{onClick:t[0]||(t[0]=r=>T("password")),class:y({"inline-block p-4 border-b-2 rounded-t-lg":!0,"border-green-600 text-green-600 dark:text-green-500 dark:border-green-500":n.value==="password","border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300":n.value!=="password"})}," Email & Password ",2)]),o("li",Z,[o("button",{onClick:t[1]||(t[1]=r=>T("otp")),class:y({"inline-block p-4 border-b-2 rounded-t-lg":!0,"border-green-600 text-green-600 dark:text-green-500 dark:border-green-500":n.value==="otp","border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300":n.value!=="otp"}),"aria-current":"page"}," Telephone & OTP ",2)])])]),o("form",{onSubmit:A(E,["prevent"]),class:"space-y-4 md:space-y-6"},[o("div",null,[s(C,{for:n.value==="password"?"login":"telephone",value:n.value==="password"?"Email Address":"Telephone Number"},null,8,["for","value"]),s(V,{id:n.value==="password"?"login":"telephone",modelValue:a(e).login,"onUpdate:modelValue":t[2]||(t[2]=r=>a(e).login=r),type:n.value==="password"?"email":"tel",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:n.value==="password"?"username":"tel",placeholder:n.value==="password"?"Enter your email address":"Enter your telephone number"},null,8,["id","modelValue","type","autocomplete","placeholder"]),s(k,{class:"mt-2",message:a(e).errors.login||a(e).errors.email},null,8,["message"])]),n.value==="password"?(m(),c("div",G,[o("div",J,[s(C,{for:"password",value:"Password"}),s(a(B),{href:l.route("password.request"),class:"text-sm text-green-600 hover:text-green-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500"},{default:g(()=>t[6]||(t[6]=[x(" Forgot your password? ")])),_:1,__:[6]},8,["href"])]),s(V,{id:"password",modelValue:a(e).password,"onUpdate:modelValue":t[3]||(t[3]=r=>a(e).password=r),type:"password",class:"mt-1 block w-full",required:"",autocomplete:"current-password",placeholder:"********"},null,8,["modelValue"]),s(k,{class:"mt-2",message:a(e).errors.password},null,8,["message"])])):b("",!0),n.value==="otp"?(m(),c("div",Q,[o("div",Y,[s(C,{for:"otp",value:"Verification Code"}),o("button",{type:"button",onClick:O,disabled:d.value>0,class:y({"text-sm rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium underline-offset-4":!0,"text-green-600 hover:text-green-900 hover:underline hover:decoration-green-600 dark:text-green-500":d.value===0,"text-gray-400 cursor-not-allowed":d.value>0})},w(d.value>0?`Resend in ${d.value}s`:"Send OTP"),11,ee)]),s(V,{id:"otp",modelValue:a(e).otp,"onUpdate:modelValue":t[4]||(t[4]=r=>a(e).otp=r),type:"text",class:"mt-1 block w-full",required:u.value,disabled:!u.value,maxlength:"6",placeholder:"Enter 6-digit code"},null,8,["modelValue","required","disabled"]),s(k,{class:"mt-2",message:a(e).errors.otp},null,8,["message"]),u.value?(m(),c("div",te," Verification code sent to your telephone ")):b("",!0)])):b("",!0),o("div",re,[o("label",oe,[s(N,{id:"remember",name:"remember",checked:a(e).remember,"onUpdate:checked":t[5]||(t[5]=r=>a(e).remember=r)},null,8,["checked"]),o("span",se,w(l.$page.props.rememberMe?l.$page.props.rememberMe:"Remember me"),1)])]),o("div",ae,[s(X,{action:"login","site-key":l.$page.props.recaptchaSiteKey,onCaptchaResponse:q},null,8,["site-key"])]),o("div",ne,[s(L,{class:y(["w-full",{"opacity-25":a(e).processing}]),disabled:a(e).processing},{default:g(()=>[x(w(n.value==="password"?"Sign In":"Verify & Sign In"),1)]),_:1},8,["class","disabled"])]),o("p",le,[t[8]||(t[8]=x(" Don't have an account yet? ")),s(a(B),{href:l.route("register"),class:"font-medium text-green-600 hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500"},{default:g(()=>t[7]||(t[7]=[x(" Sign Up ")])),_:1,__:[7]},8,["href"])])],32)])]),_:1})],64))}};export{be as default};
//# sourceMappingURL=Login-Ds2i7-Rf.js.map

import{r as h,T as A,s as m,k as c,p as o,v as a,Z as I,l as g,m as s,u as b,A as w,y,J as j,I as q,x,F as M,S as f}from"./vendor-BwcupqXt.js";import{A as U}from"./AuthenticationCard-DlV0eQgC.js";import{_ as F}from"./AuthenticationCardLogo-NFiAEaY9.js";import{_ as N}from"./Checkbox-lfofqkqg.js";import{_ as k}from"./InputError-C328GymS.js";import{_ as C}from"./InputLabel-CPp9eSBx.js";import{_ as L}from"./PrimaryButton-C1B-48uD.js";import{_ as V}from"./TextInput-DQ9j7239.js";import{_ as X}from"./ReCaptcha-BvZmVeuU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"p-2 space-y-4 md:space-y-6 sm:p-8"},H={key:0,class:"mb-4 font-medium text-sm text-green-600"},W={class:"border-b border-gray-200 dark:border-gray-700"},z={class:"flex flex-wrap -mb-px text-sm font-medium text-center"},J={class:"me-2"},K={class:"me-2"},Z={key:0},G={class:"flex items-center justify-between"},Q={key:1},Y={class:"flex items-center justify-between"},ee=["disabled"],re={key:0,class:"mt-2 text-sm text-green-600"},te={class:"flex items-center justify-between"},se={for:"remember",class:"flex items-center"},oe={class:"ms-2 text-sm text-gray-600 dark:text-gray-400"},ae={class:"mt-4"},ne={class:"mt-4"},le={class:"text-sm font-light text-gray-500 dark:text-gray-400"},be={__name:"Login",props:{canResetPassword:Boolean,status:String},setup(T){const n=h("password"),u=h(!1),d=h(0),v=h(null),e=A({login:"",password:"",otp:"",remember:!1,"g-recaptcha-response":""}),B=l=>{e["g-recaptcha-response"]=l},O=async()=>{var l,r;if(!e.login){e.errors.login="Telephone number is required";return}try{const t=await axios.post("/api/auth/request-otp",{telephone:e.login},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(t.data.status==="success")u.value=!0,E(),e.errors.login="",f.fire({toast:!0,position:"top-end",icon:"success",title:t.data.message||"OTP sent successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});else throw new Error(t.data.message||"Failed to send OTP")}catch(t){console.error("OTP Error:",t);const p=((r=(l=t.response)==null?void 0:l.data)==null?void 0:r.message)||t.message||"Failed to send OTP. Please try again.";e.errors.login=p,f.fire({toast:!0,position:"top-end",icon:"error",title:p,showConfirmButton:!1,timer:5e3,timerProgressBar:!0})}},E=()=>{d.value=60,clearInterval(v.value),v.value=setInterval(()=>{d.value>0?d.value--:clearInterval(v.value)},1e3)},P=l=>{n.value=l,e.clearErrors(),u.value=!1,clearInterval(v.value),d.value=0},R=async()=>{var l,r,t,p,$,S;if(n.value==="password")try{const i=await axios.post(route("login"),{login:e.login,password:e.password,remember:e.remember?"on":""});f.fire({toast:!0,position:"top-end",icon:"success",title:"Login successful!",showConfirmButton:!1,timer:1500}).then(()=>{window.location.href="/dashboard"})}catch(i){let _="An error occurred during login.";(r=(l=i.response)==null?void 0:l.data)!=null&&r.errors?(e.errors=i.response.data.errors,_=Object.values(i.response.data.errors).flat().join(" ")):(p=(t=i.response)==null?void 0:t.data)!=null&&p.message&&(_=i.response.data.message),f.fire({toast:!0,position:"top-end",icon:"error",title:_,showConfirmButton:!1,timer:3e3})}else try{const i=await axios.post("/api/auth/verify-otp",{telephone:e.login,otp:e.otp,remember:e.remember},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});f.fire({toast:!0,position:"top-end",icon:"success",title:"OTP verified successfully!",showConfirmButton:!1,timer:1500}).then(()=>{window.location.href=`${route("auto.login")}?telephone=${encodeURIComponent(e.login)}`})}catch(i){console.error("OTP Verification Error:",i),e.errors.otp=((S=($=i.response)==null?void 0:$.data)==null?void 0:S.message)||i.message||"An error occurred. Please try again."}};return(l,r)=>(c(),m(M,null,[o(a(I),{title:"Sign in"}),o(U,null,{logo:g(()=>[o(F)]),default:g(()=>[s("div",D,[T.status?(c(),m("div",H,w(T.status),1)):b("",!0),r[9]||(r[9]=s("h1",{class:"text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white"}," Sign in to your account ",-1)),s("div",W,[s("ul",z,[s("li",J,[s("button",{onClick:r[0]||(r[0]=t=>P("password")),class:y({"inline-block p-4 border-b-2 rounded-t-lg":!0,"border-green-600 text-green-600 dark:text-green-500 dark:border-green-500":n.value==="password","border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300":n.value!=="password"})}," Email & Password ",2)]),s("li",K,[s("button",{onClick:r[1]||(r[1]=t=>P("otp")),class:y({"inline-block p-4 border-b-2 rounded-t-lg":!0,"border-green-600 text-green-600 dark:text-green-500 dark:border-green-500":n.value==="otp","border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300":n.value!=="otp"}),"aria-current":"page"}," Telephone & OTP ",2)])])]),s("form",{onSubmit:j(R,["prevent"]),class:"space-y-4 md:space-y-6"},[s("div",null,[o(C,{for:n.value==="password"?"login":"telephone",value:n.value==="password"?"Email Address":"Telephone Number"},null,8,["for","value"]),o(V,{id:n.value==="password"?"login":"telephone",modelValue:a(e).login,"onUpdate:modelValue":r[2]||(r[2]=t=>a(e).login=t),type:n.value==="password"?"email":"tel",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:n.value==="password"?"username":"tel",placeholder:n.value==="password"?"Enter your email address":"Enter your telephone number"},null,8,["id","modelValue","type","autocomplete","placeholder"]),o(k,{class:"mt-2",message:a(e).errors.login||a(e).errors.email},null,8,["message"])]),n.value==="password"?(c(),m("div",Z,[s("div",G,[o(C,{for:"password",value:"Password"}),o(a(q),{href:l.route("password.request"),class:"text-sm text-green-600 hover:text-green-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500"},{default:g(()=>r[6]||(r[6]=[x(" Forgot your password? ")])),_:1,__:[6]},8,["href"])]),o(V,{id:"password",modelValue:a(e).password,"onUpdate:modelValue":r[3]||(r[3]=t=>a(e).password=t),type:"password",class:"mt-1 block w-full",required:"",autocomplete:"current-password",placeholder:"********"},null,8,["modelValue"]),o(k,{class:"mt-2",message:a(e).errors.password},null,8,["message"])])):b("",!0),n.value==="otp"?(c(),m("div",Q,[s("div",Y,[o(C,{for:"otp",value:"Verification Code"}),s("button",{type:"button",onClick:O,disabled:d.value>0,class:y({"text-sm rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium underline-offset-4":!0,"text-green-600 hover:text-green-900 hover:underline hover:decoration-green-600 dark:text-green-500":d.value===0,"text-gray-400 cursor-not-allowed":d.value>0})},w(d.value>0?`Resend in ${d.value}s`:"Send OTP"),11,ee)]),o(V,{id:"otp",modelValue:a(e).otp,"onUpdate:modelValue":r[4]||(r[4]=t=>a(e).otp=t),type:"text",class:"mt-1 block w-full",required:u.value,disabled:!u.value,maxlength:"6",placeholder:"Enter 6-digit code"},null,8,["modelValue","required","disabled"]),o(k,{class:"mt-2",message:a(e).errors.otp},null,8,["message"]),u.value?(c(),m("div",re," Verification code sent to your telephone ")):b("",!0)])):b("",!0),s("div",te,[s("label",se,[o(N,{id:"remember",name:"remember",checked:a(e).remember,"onUpdate:checked":r[5]||(r[5]=t=>a(e).remember=t)},null,8,["checked"]),s("span",oe,w(l.$page.props.rememberMe?l.$page.props.rememberMe:"Remember me"),1)])]),s("div",ae,[o(X,{action:"login","site-key":l.$page.props.recaptchaSiteKey,onCaptchaResponse:B},null,8,["site-key"])]),s("div",ne,[o(L,{class:y(["w-full",{"opacity-25":a(e).processing}]),disabled:a(e).processing},{default:g(()=>[x(w(n.value==="password"?"Sign In":"Verify & Sign In"),1)]),_:1},8,["class","disabled"])]),s("p",le,[r[8]||(r[8]=x(" Don't have an account yet? ")),o(a(q),{href:l.route("register"),class:"font-medium text-green-600 hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500"},{default:g(()=>r[7]||(r[7]=[x(" Sign Up ")])),_:1,__:[7]},8,["href"])])],32)])]),_:1})],64))}};export{be as default};
//# sourceMappingURL=Login-BJl1SaBY.js.map

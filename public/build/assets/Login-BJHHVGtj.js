import{f as g,T as E,i as u,o as m,e as o,u as a,Z as B,w as p,d as s,k as f,t as v,n as h,C as O,B as C,l as b,F as R,S as T}from"./vendor-Bxre9-EX.js";import{A}from"./AuthenticationCard-bbT-ft5b.js";import{_ as F}from"./AuthenticationCardLogo-CCECX_LH.js";import{_ as I}from"./Checkbox-eqsYePl1.js";import{_ as w}from"./InputError-B-044Lai.js";import{_ as y}from"./InputLabel-CwSxgxQN.js";import{_ as M}from"./PrimaryButton-Bn8ATV9O.js";import{_ as x}from"./TextInput-CQrGoHHq.js";import{_ as j}from"./ReCaptcha-CF-9UE0x.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"p-2 space-y-4 md:space-y-6 sm:p-8"},U={key:0,class:"mb-4 font-medium text-sm text-green-600"},X={class:"border-b border-gray-200 dark:border-gray-700"},L={class:"flex flex-wrap -mb-px text-sm font-medium text-center"},D={class:"me-2"},H={class:"me-2"},W={key:0},z={class:"flex items-center justify-between"},K={key:1},Z={class:"flex items-center justify-between"},G=["disabled"],J={key:0,class:"mt-2 text-sm text-green-600"},Q={class:"flex items-center justify-between"},Y={for:"remember",class:"flex items-center"},ee={class:"ms-2 text-sm text-gray-600 dark:text-gray-400"},te={class:"mt-4"},re={class:"mt-4"},se={class:"text-sm font-light text-gray-500 dark:text-gray-400"},ge={__name:"Login",props:{canResetPassword:Boolean,status:String},setup(_){const n=g("password"),d=g(!1),i=g(0),c=g(null),e=E({login:"",password:"",otp:"",remember:!1,"g-recaptcha-response":""}),P=l=>{e["g-recaptcha-response"]=l},S=async()=>{var l,t;if(!e.login){e.errors.login="Telephone number is required";return}try{const r=await axios.post("/api/auth/request-otp",{telephone:e.login},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(r.data.status==="success")d.value=!0,$(),e.errors.login="",T.fire({toast:!0,position:"top-end",icon:"success",title:r.data.message||"OTP sent successfully",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});else throw new Error(r.data.message||"Failed to send OTP")}catch(r){console.error("OTP Error:",r);const V=((t=(l=r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"Failed to send OTP. Please try again.";e.errors.login=V,T.fire({toast:!0,position:"top-end",icon:"error",title:V,showConfirmButton:!1,timer:5e3,timerProgressBar:!0})}},$=()=>{i.value=60,clearInterval(c.value),c.value=setInterval(()=>{i.value>0?i.value--:clearInterval(c.value)},1e3)},k=l=>{n.value=l,e.clearErrors(),d.value=!1,clearInterval(c.value),i.value=0},q=async()=>{var l,t;if(n.value==="password")e.transform(r=>({...r,remember:e.remember?"on":""})).post(route("login"),{onFinish:()=>e.reset("password")});else try{const r=await axios.post("/api/auth/verify-otp",{telephone:e.login,otp:e.otp,authenticate:!0},{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});r.data.redirect?window.location.href=r.data.redirect:window.location.href="/dashboard"}catch(r){console.error("OTP Verification Error:",r),e.errors.otp=((t=(l=r.response)==null?void 0:l.data)==null?void 0:t.message)||r.message||"An error occurred. Please try again."}};return(l,t)=>(m(),u(R,null,[o(a(B),{title:"Sign in"}),o(A,null,{logo:p(()=>[o(F)]),default:p(()=>[s("div",N,[_.status?(m(),u("div",U,v(_.status),1)):f("",!0),t[9]||(t[9]=s("h1",{class:"text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white"}," Sign in to your account ",-1)),s("div",X,[s("ul",L,[s("li",D,[s("button",{onClick:t[0]||(t[0]=r=>k("password")),class:h({"inline-block p-4 border-b-2 rounded-t-lg":!0,"border-green-600 text-green-600 dark:text-green-500 dark:border-green-500":n.value==="password","border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300":n.value!=="password"})}," Email & Password ",2)]),s("li",H,[s("button",{onClick:t[1]||(t[1]=r=>k("otp")),class:h({"inline-block p-4 border-b-2 rounded-t-lg":!0,"border-green-600 text-green-600 dark:text-green-500 dark:border-green-500":n.value==="otp","border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300":n.value!=="otp"}),"aria-current":"page"}," Telephone & OTP ",2)])])]),s("form",{onSubmit:O(q,["prevent"]),class:"space-y-4 md:space-y-6"},[s("div",null,[o(y,{for:n.value==="password"?"login":"telephone",value:n.value==="password"?"Email Address":"Telephone Number"},null,8,["for","value"]),o(x,{id:n.value==="password"?"login":"telephone",modelValue:a(e).login,"onUpdate:modelValue":t[2]||(t[2]=r=>a(e).login=r),type:n.value==="password"?"email":"tel",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:n.value==="password"?"username":"tel",placeholder:n.value==="password"?"Enter your email address":"Enter your telephone number"},null,8,["id","modelValue","type","autocomplete","placeholder"]),o(w,{class:"mt-2",message:a(e).errors.login||a(e).errors.email},null,8,["message"])]),n.value==="password"?(m(),u("div",W,[s("div",z,[o(y,{for:"password",value:"Password"}),o(a(C),{href:l.route("password.request"),class:"text-sm text-green-600 hover:text-green-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500"},{default:p(()=>t[6]||(t[6]=[b(" Forgot your password? ")])),_:1,__:[6]},8,["href"])]),o(x,{id:"password",modelValue:a(e).password,"onUpdate:modelValue":t[3]||(t[3]=r=>a(e).password=r),type:"password",class:"mt-1 block w-full",required:"",autocomplete:"current-password",placeholder:"********"},null,8,["modelValue"]),o(w,{class:"mt-2",message:a(e).errors.password},null,8,["message"])])):f("",!0),n.value==="otp"?(m(),u("div",K,[s("div",Z,[o(y,{for:"otp",value:"Verification Code"}),s("button",{type:"button",onClick:S,disabled:i.value>0,class:h({"text-sm rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium underline-offset-4":!0,"text-green-600 hover:text-green-900 hover:underline hover:decoration-green-600 dark:text-green-500":i.value===0,"text-gray-400 cursor-not-allowed":i.value>0})},v(i.value>0?`Resend in ${i.value}s`:"Send OTP"),11,G)]),o(x,{id:"otp",modelValue:a(e).otp,"onUpdate:modelValue":t[4]||(t[4]=r=>a(e).otp=r),type:"text",class:"mt-1 block w-full",required:d.value,disabled:!d.value,maxlength:"6",placeholder:"Enter 6-digit code"},null,8,["modelValue","required","disabled"]),o(w,{class:"mt-2",message:a(e).errors.otp},null,8,["message"]),d.value?(m(),u("div",J," Verification code sent to your telephone ")):f("",!0)])):f("",!0),s("div",Q,[s("label",Y,[o(I,{id:"remember",name:"remember",checked:a(e).remember,"onUpdate:checked":t[5]||(t[5]=r=>a(e).remember=r)},null,8,["checked"]),s("span",ee,v(l.$page.props.rememberMe?l.$page.props.rememberMe:"Remember me"),1)])]),s("div",te,[o(j,{action:"login","site-key":l.$page.props.recaptchaSiteKey,onCaptchaResponse:P},null,8,["site-key"])]),s("div",re,[o(M,{class:h(["w-full",{"opacity-25":a(e).processing}]),disabled:a(e).processing},{default:p(()=>[b(v(n.value==="password"?"Sign In":"Verify & Sign In"),1)]),_:1},8,["class","disabled"])]),s("p",se,[t[8]||(t[8]=b(" Don't have an account yet? ")),o(a(C),{href:l.route("register"),class:"font-medium text-green-600 hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500"},{default:p(()=>t[7]||(t[7]=[b(" Sign Up ")])),_:1,__:[7]},8,["href"])])],32)])]),_:1})],64))}};export{ge as default};
//# sourceMappingURL=Login-BJHHVGtj.js.map

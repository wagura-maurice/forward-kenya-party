{"version":3,"file":"Login-BJHHVGtj.js","sources":["../../../resources/js/Pages/Auth/Login.vue"],"sourcesContent":["<script setup>\nimport { Head, Link, useForm } from \"@inertiajs/vue3\";\nimport AuthenticationCard from \"@/Components/AuthenticationCard.vue\";\nimport AuthenticationCardLogo from \"@/Components/AuthenticationCardLogo.vue\";\nimport Checkbox from \"@/Components/Checkbox.vue\";\nimport InputError from \"@/Components/InputError.vue\";\nimport InputLabel from \"@/Components/InputLabel.vue\";\nimport PrimaryButton from \"@/Components/PrimaryButton.vue\";\nimport TextInput from \"@/Components/TextInput.vue\";\nimport ReCaptcha from '@/Components/ReCaptcha.vue';\nimport { ref } from 'vue';\nimport Swal from 'sweetalert2';\n\ndefineProps({\n    canResetPassword: Boolean,\n    status: String,\n});\n\nconst activeTab = ref('password'); // 'password' or 'otp'\nconst otpSent = ref(false);\nconst otpCountdown = ref(0);\nconst otpTimer = ref(null);\n\nconst form = useForm({\n    login: \"\", // For both email and telephone\n    password: \"\",\n    otp: \"\", // For OTP login\n    remember: false,\n    'g-recaptcha-response': '',\n});\n\nconst setCaptchaResponse = (response) => {\n    form['g-recaptcha-response'] = response;\n};\n\n// Send OTP function\nconst sendOtp = async () => {\n    if (!form.login) {\n        form.errors.login = 'Telephone number is required';\n        return;\n    }\n\n    try {\n        const response = await axios.post('/api/auth/request-otp', {\n            telephone: form.login\n        }, {\n            headers: {\n                'Accept': 'application/json',\n                'X-Requested-With': 'XMLHttpRequest'\n            }\n        });\n\n        if (response.data.status === 'success') {\n            otpSent.value = true;\n            startOtpCountdown();\n            form.errors.login = ''; // Clear any previous errors\n            \n            // Show success toast\n            Swal.fire({\n                toast: true,\n                position: 'top-end',\n                icon: 'success',\n                title: response.data.message || 'OTP sent successfully',\n                showConfirmButton: false,\n                timer: 3000,\n                timerProgressBar: true\n            });\n        } else {\n            throw new Error(response.data.message || 'Failed to send OTP');\n        }\n    } catch (error) {\n        console.error('OTP Error:', error);\n        const errorMessage = error.response?.data?.message || error.message || 'Failed to send OTP. Please try again.';\n        form.errors.login = errorMessage;\n        \n        // Show error toast\n        Swal.fire({\n            toast: true,\n            position: 'top-end',\n            icon: 'error',\n            title: errorMessage,\n            showConfirmButton: false,\n            timer: 5000,\n            timerProgressBar: true\n        });\n    }\n};\n\n// Start OTP countdown timer\nconst startOtpCountdown = () => {\n    otpCountdown.value = 60; // 60 seconds countdown\n    clearInterval(otpTimer.value);\n    otpTimer.value = setInterval(() => {\n        if (otpCountdown.value > 0) {\n            otpCountdown.value--;\n        } else {\n            clearInterval(otpTimer.value);\n        }\n    }, 1000);\n};\n\n// Switch tabs\nconst switchTab = (tab) => {\n    activeTab.value = tab;\n    form.clearErrors();\n    otpSent.value = false;\n    clearInterval(otpTimer.value);\n    otpCountdown.value = 0;\n};\n\nconst submit = async () => {\n    if (activeTab.value === 'password') {\n        form.transform((data) => ({\n            ...data,\n            remember: form.remember ? \"on\" : \"\",\n        })).post(route(\"login\"), {\n            onFinish: () => form.reset(\"password\"),\n        });\n    } else {\n        // OTP login flow\n        try {\n            const response = await axios.post('/api/auth/verify-otp', {\n                telephone: form.login,\n                otp: form.otp,\n                authenticate: true\n            }, {\n                headers: {\n                    'Accept': 'application/json',\n                    'X-Requested-With': 'XMLHttpRequest'\n                }\n            });\n\n            if (response.data.redirect) {\n                window.location.href = response.data.redirect;\n            } else {\n                window.location.href = '/dashboard';\n            }\n        } catch (error) {\n            console.error('OTP Verification Error:', error);\n            form.errors.otp = error.response?.data?.message || error.message || 'An error occurred. Please try again.';\n        }\n    }\n};\n</script>\n\n<template>\n    <Head title=\"Sign in\" />\n\n    <AuthenticationCard>\n        <template #logo>\n            <AuthenticationCardLogo />\n        </template>\n\n        <div class=\"p-2 space-y-4 md:space-y-6 sm:p-8\">\n            <div v-if=\"status\" class=\"mb-4 font-medium text-sm text-green-600\">\n                {{ status }}\n            </div>\n\n            <h1 class=\"text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white\">\n                Sign in to your account\n            </h1>\n\n            <!-- Login Method Tabs -->\n            <div class=\"border-b border-gray-200 dark:border-gray-700\">\n                <ul class=\"flex flex-wrap -mb-px text-sm font-medium text-center\">\n                    <li class=\"me-2\">\n                        <button\n                            @click=\"switchTab('password')\"\n                            :class=\"{\n                                'inline-block p-4 border-b-2 rounded-t-lg': true,\n                                'border-green-600 text-green-600 dark:text-green-500 dark:border-green-500': activeTab === 'password',\n                                'border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300': activeTab !== 'password'\n                            }\"\n                        >\n                            Email & Password\n                        </button>\n                    </li>\n                    <li class=\"me-2\">\n                        <button\n                            @click=\"switchTab('otp')\"\n                            :class=\"{\n                                'inline-block p-4 border-b-2 rounded-t-lg': true,\n                                'border-green-600 text-green-600 dark:text-green-500 dark:border-green-500': activeTab === 'otp',\n                                'border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300': activeTab !== 'otp'\n                            }\"\n                            aria-current=\"page\"\n                        >\n                            Telephone & OTP\n                        </button>\n                    </li>\n                </ul>\n            </div>\n\n            <form @submit.prevent=\"submit\" class=\"space-y-4 md:space-y-6\">\n                <!-- Email/Telephone Input -->\n                <div>\n                    <InputLabel \n                        :for=\"activeTab === 'password' ? 'login' : 'telephone'\" \n                        :value=\"activeTab === 'password' ? 'Email Address' : 'Telephone Number'\" \n                    />\n                    <TextInput\n                        :id=\"activeTab === 'password' ? 'login' : 'telephone'\"\n                        v-model=\"form.login\"\n                        :type=\"activeTab === 'password' ? 'email' : 'tel'\"\n                        class=\"mt-1 block w-full\"\n                        required\n                        autofocus\n                        :autocomplete=\"activeTab === 'password' ? 'username' : 'tel'\"\n                        :placeholder=\"activeTab === 'password' ? 'Enter your email address' : 'Enter your telephone number'\"\n                    />\n                    <InputError class=\"mt-2\" :message=\"form.errors.login || form.errors.email\" />\n                </div>\n\n                <!-- Password Input (only for password tab) -->\n                <div v-if=\"activeTab === 'password'\">\n                    <div class=\"flex items-center justify-between\">\n                        <InputLabel for=\"password\" value=\"Password\" />\n                        <Link :href=\"route('password.request')\"\n                            class=\"text-sm text-green-600 hover:text-green-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500\"\n                        >\n                            Forgot your password?\n                        </Link>\n                    </div>\n                    <TextInput\n                        id=\"password\"\n                        v-model=\"form.password\"\n                        type=\"password\"\n                        class=\"mt-1 block w-full\"\n                        required\n                        autocomplete=\"current-password\"\n                        placeholder=\"********\"\n                    />\n                    <InputError class=\"mt-2\" :message=\"form.errors.password\" />\n                </div>\n\n                <!-- OTP Input (only for OTP tab) -->\n                <div v-if=\"activeTab === 'otp'\">\n                    <div class=\"flex items-center justify-between\">\n                        <InputLabel for=\"otp\" value=\"Verification Code\" />\n                        <button\n                            type=\"button\"\n                            @click=\"sendOtp\"\n                            :disabled=\"otpCountdown > 0\"\n                            :class=\"{\n                                'text-sm rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 font-medium underline-offset-4': true,\n                                'text-green-600 hover:text-green-900 hover:underline hover:decoration-green-600 dark:text-green-500': otpCountdown === 0,\n                                'text-gray-400 cursor-not-allowed': otpCountdown > 0\n                            }\"\n                        >\n                            {{ otpCountdown > 0 ? `Resend in ${otpCountdown}s` : 'Send OTP' }}\n                        </button>\n                    </div>\n                    <TextInput\n                        id=\"otp\"\n                        v-model=\"form.otp\"\n                        type=\"text\"\n                        class=\"mt-1 block w-full\"\n                        :required=\"otpSent\"\n                        :disabled=\"!otpSent\"\n                        maxlength=\"6\"\n                        placeholder=\"Enter 6-digit code\"\n                    />\n                    <InputError class=\"mt-2\" :message=\"form.errors.otp\" />\n                    \n                    <div v-if=\"otpSent\" class=\"mt-2 text-sm text-green-600\">\n                        Verification code sent to your telephone\n                    </div>\n                </div>\n\n                <!-- Remember Me -->\n                <div class=\"flex items-center justify-between\">\n                    <label for=\"remember\" class=\"flex items-center\">\n                        <Checkbox\n                            id=\"remember\"\n                            name=\"remember\"\n                            v-model:checked=\"form.remember\"\n                        />\n                        <span class=\"ms-2 text-sm text-gray-600 dark:text-gray-400\">\n                            {{ $page.props.rememberMe ? $page.props.rememberMe : 'Remember me' }}\n                        </span>\n                    </label>\n                </div>\n\n                <!-- reCAPTCHA Component -->\n                <div class=\"mt-4\">\n                    <ReCaptcha \n                        action=\"login\" \n                        :site-key=\"$page.props.recaptchaSiteKey\" \n                        @captcha-response=\"setCaptchaResponse\" \n                    />\n                </div>\n\n                <!-- Sign In Button -->\n                <div class=\"mt-4\">\n                    <PrimaryButton\n                        class=\"w-full\"\n                        :class=\"{ 'opacity-25': form.processing }\"\n                        :disabled=\"form.processing\"\n                    >\n                        {{ activeTab === 'password' ? 'Sign In' : 'Verify & Sign In' }}\n                    </PrimaryButton>\n                </div>\n\n                <!-- Sign Up Link -->\n                <p class=\"text-sm font-light text-gray-500 dark:text-gray-400\">\n                    Don't have an account yet?\n                    <Link\n                        :href=\"route('register')\"\n                        class=\"font-medium text-green-600 hover:underline hover:decoration-green-600 hover:dark:decoration-green-500 underline-offset-4 dark:text-green-500\"\n                    >\n                        Sign Up\n                    </Link>\n                </p>\n            </form>\n        </div>\n    </AuthenticationCard>\n</template>"],"names":["activeTab","ref","otpSent","otpCountdown","otpTimer","form","useForm","setCaptchaResponse","response","sendOtp","startOtpCountdown","Swal","error","errorMessage","_b","_a","switchTab","tab","submit","data","_createVNode","_unref","Head","AuthenticationCard","AuthenticationCardLogo","_createElementVNode","_hoisted_1","__props","_createElementBlock","_hoisted_2","_toDisplayString","_cache","_hoisted_3","_hoisted_4","_hoisted_5","_normalizeClass","_hoisted_6","InputLabel","TextInput","$event","InputError","_hoisted_7","_hoisted_8","Link","route","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","Checkbox","_hoisted_15","$page","_hoisted_16","ReCaptcha","_hoisted_17","PrimaryButton","_hoisted_18"],"mappings":"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"}